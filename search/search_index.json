{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>Interested in contributing? We'd love to have you on board! Click here</p> <p>Want to skip to the server installation guide? Click here</p> <p>Have a question? It might be in here</p>"},{"location":"#what-is-spacebar","title":"What is Spacebar?","text":"<p>Spacebar is a free open source reimplementation and extension of Discord's client-server API, with the goal of complete feature parity with discord.com, all while adding some additional goodies, security, privacy, and configuration options.</p> <p>Spacebar allows you to host a complete, discord.com-compatible chat service with complete control over it's content, usage, security, configuration, and featureset. Being discord.com-compatible will allow all existing clients, bots, and applications written for discord.com to be used on any Spacebar instance, which we believe will be immensely useful for any transition process between services.</p> <p>As Spacebar is an entirely separate service from discord.com, it means a Spacebar server by itself cannot access private data controlled by discord.com. You cannot use a Spacebar server to chat with your friends on discord.com. You also cannot use a Spacebar server to grant premium (\"Nitro\") features to a discord.com account (although you can grant these to a Spacebar account).</p> <p>Our goal is to achieve complete feature parity with discord.com, as well as implement additional security, privacy, and other useful features serverside. In addition to our server software, we aim to create Spacebar-aware clients that can be used to connect to multiple Spacebar-compatible instances with rich theming and plugin support.</p>"},{"location":"#support","title":"Support","text":"<p>For any kind of support regarding Spacebar, feel free to ask questions in our discord.com guild or our official Spacebar instance.</p> <p>For bug reporting and feature requests please create an issue on Github.</p>"},{"location":"faq/","title":"Frequently Asked Questions","text":"Is Spacebar still in development? Production Ready? <p>Yes, Spacebar is still in development. Our unpaid team of volunteers is very small though, and so progress is very dependant on our motivation and outside life.</p> <p>The Spacebar server program has been in development since at least 28/11/2020, and has most core features implemented. API compatibility is reasonable although not quite perfect and so some third party clients may not function, although the official Discord.com client which we test against functions correctly for the most part.</p> <p>The big Discord.com features currently left unimplemented or with partial implementations are:</p> <ul> <li>Voice/Video support (WebRTC protocol support implemented, but lacking UDP protocol implementation)</li> <li>Voice activities</li> <li>OAuth2 scopes and other applications (Bot applications work by are left unscoped)</li> <li>Message threads</li> <li>Pomelo (new username system without discriminators)</li> <li>Auto moderation</li> </ul> <p>For a more complete overview of what is left unimplemented, please refer to the missing routes viewer</p> <p>The Spacebar client however is very premature, starting development around 1/03/2023. It is not ready production use or as your daily driver. It lacks many core features and is not recommended to be used. Please setup a third party client, or help contribute to our codebase! Any and all help is appreciated.</p> How do you use the Client? <p>As described in Clients, the official client is not ready yet. You are free to use a Spacebar compatible client to connect, but no support will be provided.</p> Voice/Video when? <p>Currently there is experimental voice/video WebRTC support in Spacebar. UDP connections are not currently supported.</p> <p>This is a very difficult feature to get working, especially given that we must implement it the exact same way as Discord.com for client compatibility, so if you find any bugs please open an issue in Spacebar server.</p> <p>We would also be incredibly thankful for any assistance.</p> Free Nitro? <p>Please do not use Discord trademarks to refer to anything regarding Spacebar. As an instance owner, you can grant yourself or others premium features which may be used to determine your abilities client-side. However, Spacebar-server currently does not have any distinction between premium and free users. All users can access all features, given they have the rights to do so.</p> <p>You cannot give yourself premium features on Discord.com using a Spacebar instance.</p> How do I boost my guild? Or, how do I buy premium? <p>You cannot buy premium features through Spacebar, as Spacebar does not support any payment backend.</p> <p>Additionally, Spacebar does not currently have any distinction between premium and free users or guilds. All users and guilds have access to all features server-side.</p> <p>In the case of users, you may run into issues with the client preventing you from using certain features, if the user's <code>premium_type</code> or <code>premium</code> values are not set correctly. By default, Spacebar will do this for you, however.</p> <p>In the case of guilds, you may run into issues with uploading animated icons or banners, etc. If so, simply give the guild the features you require. You can set them to be given to all guilds by default using the config <code>guild_defaultFeatures</code> array.</p> Can I log in with my Discord account? <p>No. Spacebar and Discord are entirely separate services, with their own separate databases and authentication. Spacebar cannot access any private data from Discord.com. As always, you should not provide login credentials for Discord.com, or any other service, to others.</p> Does Spacebar use the same servers as Discord? <p>No. Discord servers, as in the bare-metal running the service, are completely inaccessible to people, outside of course the Discord.com service provided. It is impossible for us to use their infrastructure. Spacebar instances are hosted entirely by their owner(s).</p> <p>If you mean Discord 'server' as in a guild, also no. Spacebar is not a proxy for Discord guilds. Spacebar does not create Discord.com accounts or ask for your own at any time (outside of OAuth features provided by the instance such as account connections or 'login with' buttons) If Spacebar was to try this, Discord's automated spam filters would surely block your instance, and ban any offending accounts.</p> <p>Lastly, you can simply view our codebase. A simple proxy would not need to be this complex or large. We implement the entire Discord.com API, Gateway, among others. None of this would be necessary if we were simply abusing Discord.com.</p> Do you use Discord.com code? <p>Absolutely not. If a potential contributor makes any indication of being a Discord employee, or to have access to leaked Discord.com code, we take measures in line with our Code of Conduct to ensure the Spacebar codebase is free of any proprietary code. We want absolutely nothing to do with it.</p> Is this illegal? <p>The Spacebar maintainers do not believe it to be, no. See: Oracle v. Google.</p> Why are you doing this, anyway? <ol> <li>We love free, open source software.</li> <li>There are many existing bots, applications, users, features, and ideas surrounding Discord.com.</li> <li>Spacebar allows these users and developers to maintain a familiar ecosystem with minimal friction.</li> <li>Reimplementing allows us to extend the Discord protocol in ways Discord.com may not deem feasible, economical, whateverical.</li> <li>This includes privacy features, such as end to end encryption for example.</li> <li>The reverse engineering effort by our team may be useful to outside developers looking to understand how similar services work.</li> <li>The Discord protocol, despite its API complexity, is quite simple and linear. No complex conflict resolution like Matrix, for example.</li> </ol> Editing the database is annoying, is there a graphical interface for this? <p>Currently no, there is no graphical interface for managing your Spacebar instance. An admin dashboard is planned, but we currently have higher priorities right now.</p> When will this feature be available? <p>We do not provide ETAs. Users tend to take them as deadlines, and for a small team of &lt;5 maintainers who do not get payment for their work, this is unreasonable.</p> It's pretty funny how you have a Discord.com guild for support. <p>We know. Also that's not a question.</p>"},{"location":"contributing/","title":"Contributing","text":"<p>Have you read the Code of Conduct?</p>"},{"location":"contributing/#style-and-a-note-on-etiquette","title":"Style and a note on etiquette","text":"<ul> <li>We use prettier for code formatting. We have a <code>.prettierrc</code> file in spacebar-server's root     and use a git precommit hook to autorun it.</li> <li>Try to stay consistent with the rest of the project</li> <li>Try to keep each commit to a single feature or idea, with descriptions of what it is and why it is done. No \"Large refactor\" commits that touch every file,     unless absolutely required due to the nature of change.</li> <li>Leave comments in your code about why something is done when appropriate, not just what it is doing.</li> <li>If you're working on a feature, please announce that you're working on it (in the relevant GH issue or our Discord, preferably both),     so that we can work more effectively and minimise conflicting change attempts.     Additionally, please do not try to snipe features that others are working on.</li> </ul>"},{"location":"contributing/#structure","title":"Structure","text":"<p>Spacebar is written in TypeScript and is comprised of 4 main parts:</p> <ul> <li>REST HTTP API server</li> <li>Websocket Gateway server for realtime communication with clients</li> <li>HTTP CDN server for storing user file content.</li> <li><code>utils</code> module to separate our database models, schemas, and other things from the above 3 components.</li> </ul>"},{"location":"contributing/#implementing-endpoints-opcodes-etc","title":"Implementing endpoints, opcodes, etc","text":"<p>Generally, the approach is to just see what the Discord.com client sends and receives from Discord.com (through your browsers devtools, for example) and guessing about any functionality server-side, if it's undocumented.</p> <p>For a lot of things it's pretty simple to guess, <code>GET /api/users/@me</code> returns private details about your user for example. This route is also detailed in Discords own documentation, here specifically.</p> <p>Discord generally does not document anything that is not related to application/bot development, though. As an example, <code>GET /api/updates?platform={}</code> which returns the <code>url</code>, <code>pub_date</code>, <code>name</code> and any <code>notes</code> about the latest client release for a platform.</p> <p>For the Gateway it's the same procedure, except now you can't use the network logger of your devtools because the gateway returns responses encoded with erlpack. Easy fix though, just edit the <code>DeveloperOptionsStore</code> localStorage key so that <code>logGatewayEvents</code> is true, and reload the client.</p> <p>Warning</p> <p>Make sure you rerun <code>npm run build</code> every time you edit source code, or just use <code>npm run watch</code> to make TypeScript automatically recompile on code changes. Wenn making changes to schemas or HTTP routes, run <code>npm run generate:schemas</code> and <code>npm run generate:openapi</code> to update the schemas used for validating incoming requests and generating the API documentation.</p>"},{"location":"contributing/conduct/","title":"Code of Conduct","text":"<p>By contributing to or interacting with Spacebar or Spacebar community spaces, you accept the code of conduct.</p> <p>This code of conduct is based on the Artemis Lena Code of Conduct by FantasyCookie17. As it is licensed under CC0, it may be used by other communities in modified or unmodified form without permission from the author. Its purpose is to ensure a civilised, tolerant, compassionate, helpful, pluralistic, and peaceful style of communication.</p> <p>Spacebar community spaces includes Spacebar github repositories and Spacebar development guilds (be it on Discord.com or Spacebar instances mananged by the Spacebar maintainers group).</p> <p>By contributing to any Spacebar projects (for example, through pull request) you guarantee that you have the rights to resign all rights to Spacebar under the AGPLV3 license.</p>"},{"location":"contributing/conduct/#desirable-behaviour","title":"Desirable Behaviour","text":"<ul> <li>If possible, provide assistance with Spacebar projects to other users.</li> <li>Be respectful toward other's opinions and viewpoints.</li> <li>Accepting responsibility and apologizing to those affected for our mistakes.</li> </ul>"},{"location":"contributing/conduct/#prohibited-behaviour","title":"Prohibited Behaviour","text":"<ol> <li>Sharing leaked, proprietary source code from Discord Inc</li> <li>Homophobia, transphobia, etc, misgendering, deadnaming, assuming gender. You should use singular they/them when in doubt.</li> <li>Threats of violence</li> <li>Harassment</li> <li>Spreading hateful, violent, or discriminatory ideologies or conspiracy theories, via media or text (including avatars and nicknames)</li> <li>Trolling. Intentionally derailing conversations or producing discussions on non-issues.</li> <li>Doxing. Disclosing other's private information without their consent.</li> <li>Spamming. This includes sending advertisements, repeatedly sending meaningless content, sending server invites unrequested.</li> <li>Sharing media that may cause harm or be triggering to others, such as flashing imagery or gore.</li> <li>Undesired automation of services that may lead to a reduction in service quality. For example, API spam of a Spacebar instance.</li> <li>Ban evasion. Creation of additional accounts used to join a community after being banned from that community.</li> <li>Posting content that is illegal to publish or distribute in Germany.</li> <li>Abusing loopholes in this code of conduct, or being in conflict with the goals of this code of conduct.</li> </ol>"},{"location":"contributing/conduct/#consequences-of-violation","title":"Consequences of Violation","text":"<ul> <li>Written warnings, followed by kicks or bans if repeated.</li> <li>If a violation is particularly egregious, an immediate kick or ban may be issued.</li> <li>Offending content may be removed</li> <li>Kicks and bans apply to all communities administered by the Spacebar maintainers group.</li> </ul>"},{"location":"contributing/conduct/#reporting-problems","title":"Reporting problems","text":"<p>You may report any violation of this code of conduct to the Spacebar community team directly through Discord, private message or otherwise.</p> <p>If you believe us to be in violation of this code of conduct, please report it to someone in a higher position, or to many people on the team. Make sure to provide a direct quote from here to be as effective as possible.</p>"},{"location":"contributing/conduct/#changes-to-this-document","title":"Changes to this document","text":"<p>This code of conduct may be changed in order to enhance clarity and precision at any time. Notification should be provided</p>"},{"location":"contributing/instances/","title":"For Instance Owners","text":"<p>The below are the rules for instance owners who look to be featured in our community instances list. If you do not meet these criteria, your instance will simply not be featured on our website.</p> <p>Your instance:</p> <ol> <li>Rules must be in line with our Code of Conduct.</li> <li>Must not contain any Discord Inc. branding, such as including \"cord\" in the name or the Discord logo in promotional material.</li> <li>Must not host the Discord Inc. client in any capacity.</li> <li>Must be moderated for at least publically accessible guilds. This includes guilds accessible from Discovery or a 'guild directory' channel in an auto join guild.</li> <li>Must have at least regular uptime, meaning it is available at a consistent time of day.</li> <li>Must have a valid and monitored <code>general_correspondenceEmail</code> config set.</li> <li>Must not have default rights that include operator or other administrative rights.</li> <li>Use an image proxy, e.g. Imagor, as no image proxy allows attackers to learn user IP addresses.</li> <li>Have a valid SSL/TLS certificate for all endpoints.</li> </ol> <p>We recommend (not required) that you:</p> <ul> <li>Enable Email verification, for anti-spam purposes.</li> <li>Enable Captcha, for anti-spam purposes.</li> <li>Run your instance under SystemD or a similar system in your distro, for automatic restarting.</li> <li>Provide some mechanism for users to report content. This may be as simple as more openly advertising your correspondence email (i.e. outside <code>GET /api/policies/instance</code> or <code>/api/ping</code>).</li> <li>Provide some mechanism for instance status, such as Grafana.</li> <li>Host a <code>/.well-known/spacebar</code> file on the domain you wish users associate with your instance, e.g. <code>spacebar.chat</code>.     If doing so, use this domain as the <code>url</code> field in your community instances PR.</li> </ul>"},{"location":"contributing/server/","title":"Contributing to spacebar-server","text":""},{"location":"contributing/server/#migrations","title":"Migrations","text":""},{"location":"contributing/server/#missing-routes","title":"Missing routes","text":""},{"location":"contributing/server/migrations/","title":"Migrations","text":""},{"location":"contributing/server/migrations/#what-you-need-to-know","title":"What you need to know","text":"<ul> <li>SQL</li> <li>Preferably the various syntax of SQL used by MariaDB/MySQL and Postgres.     Although if you only write the migration for one, making a PR so others can is good enough.</li> </ul>"},{"location":"contributing/server/migrations/#generating-migrations","title":"Generating Migrations","text":"<p>To generate a database migration in spacebar-server:</p> <ol> <li>On the branch/commit you want to migrate from, generate the database.    You can run the server or run <code>npm run sync:db</code>.</li> <li> <p>Switch to branch/commit you want to migrate to, and run</p> <pre><code>npm run generate:migration -- src/util/migrations/:dbms:/:migrationName:\n</code></pre> <p>where <code>:dbms:</code> is the db you use, and <code>:migrationName:</code> is whatever you wish to call it. The migration must be named a valid Javascript class name.</p> </li> <li> <p>The generated file is what TypeORM will do if you were to run <code>npm run sync:db</code>.    Obviously, this is not always what you want. Edit it to preserve as much of the original data as possible.</p> </li> </ol> <p>Once you've got your migration written, running the server will automatically run the migrations. Make sure you have backups of the original (step one) database, so you don't have to keep switching branches.</p>"},{"location":"contributing/server/missingroute/","title":"Missing Routes","text":"<p>Below is a list of routes available on Discord.com that the Spacebar server does not currently implement.</p> <p>It does not account for different HTTP methods (GET, POST, etc). A single method implemented will remove it from this list, so be sure to double check in the Spacebar source code.</p> <p>It is generated automatically by spacebarchat/missing-routes, by scraping the latest Discord.com client.</p> <p></p>"},{"location":"setup/","title":"Setup","text":""},{"location":"setup/#server","title":"Server","text":""},{"location":"setup/#bots","title":"Bots","text":""},{"location":"setup/#clients","title":"Clients","text":""},{"location":"setup/bots/","title":"Bots and Applications","text":"<p>Spacebar is compatible with Discord.com, and so all existing bots and applications designed for Discord.com should work relatively easily when connected to a Spacebar instance instead.</p>"},{"location":"setup/bots/#bot-libraries","title":"Bot Libraries","text":"<p>Below are some popular libraries for connecting bots to a Spacebar instance.</p> <p>Make sure to replace <code>api.spacebar.chat</code> and <code>cdn.spacebar.chat</code> with the appropriate URLs of the instance you want to connect to.</p> <p>You can get them from a client or from the well-known instance endpoint.</p>"},{"location":"setup/bots/#discordjs","title":"discord.js","text":"<p>The <code>Client</code> class constructor accepts configuration options that can be used to change the endpoints.</p> <pre><code>const { Client } = require(\"discord.js\");\n\nconst client = new Client({\nrest: {\napi: \"https://api.spacebar.chat/api\",\ncdn: \"https://cdn.spacebar.chat\",\nversion: \"9\"\n},\nws: {\nversion: 9\n},\n// intents, ...\n});\n\nclient.login(\"your token here\");\n</code></pre>"},{"location":"setup/bots/#discordpy","title":"discord.py","text":"<pre><code>import discord\n\ndiscord.http.Route.BASE = \"https://api.spacebar.chat/api\"\nclient = discord.Client()\n\nclient.run(\"your token here\")\n</code></pre>"},{"location":"setup/bots/#jda","title":"JDA","text":"<ol> <li>Create a RestConfig instance: <code>RestConfig restConfig = new RestConfig();</code></li> <li>Use RestConfig#setBaseUrl to tell JDA what your Rest URI is: <code>restConfig.setBaseUrl(\"https://api.spacebar.chat/api/v9\");</code></li> <li>Create another class, and extend ConcurrentSessionController, e.g. <code>public class SpacebarSessionController extends ConcurrentSessionController</code></li> <li>Override the ConcurrentSessionController#getGateway method: <pre><code>    @NotNull\n@Override\npublic String getGateway() {\nreturn \"wss://gateway.spacebar.chat/?encoding=json&amp;v=9&amp;compress=zlib-stream\";\n}\n</code></pre></li> <li>Finally, configure JDA to use your RestConfig &amp; SpacebarSessionController, like this: <pre><code>JDA jda = JDABuilder.createDefault(\"your token here\")\n.setRestConfig(restConfig)\n.setSessionController(new SpacebarSessionController())\n.build();\n</code></pre></li> </ol>"},{"location":"setup/bots/usage/","title":"Bot and application usage","text":""},{"location":"setup/bots/usage/#creating-an-application","title":"Creating an application","text":"<p>If your client doesn't have a Developer Portal (yet), you can use the below API requests to create an application. Make sure to replace the instance API URL if it's different.</p> <ol> <li>Create an application:     <pre><code>POST https://api.spacebar.chat/api/v9/applications\nAuthorization: &lt;User token, e.g. from initial Gateway connection to instance&gt;\nContent-Type: application/json\n\n{\n    \"name\": \"My Application\"\n}\n</code></pre></li> <li>Note the returned <code>id</code>.</li> <li>Create a bot:     <pre><code>POST https://api.spacebar.chat/api/v9/applications/&lt;id&gt;/bot\nAuthorization: &lt;User token&gt;\n</code></pre></li> </ol> <p>This will return a token for you to use.</p>"},{"location":"setup/bots/usage/#adding-an-application-to-a-server","title":"Adding an application to a server","text":"<pre><code>POST https://api.spacebar.chat/api/v9/oauth2/authorize?client_id=&lt;id&gt;\nAuthorization: &lt;User token of server owner/member with Manage Guild permissions&gt;\nContent-Type: application/json\n\n{\n    \"guild_id\": \"&lt;server ID&gt;\",\n    \"permissions\": \"&lt;permission BigInt, e.g. 0 for no permissions or 8 for Administrator&gt;\",\n    \"authorize\": true\n}\n</code></pre>"},{"location":"setup/clients/","title":"Clients","text":""},{"location":"setup/clients/#official-client","title":"Official Client","text":""},{"location":"setup/clients/#fermi","title":"Fermi","text":""},{"location":"setup/clients/fermi/","title":"Fermi","text":"<p>Fermi currently only has 1 version:</p> <ul> <li>The web version which is currently under active development. Web Client</li> </ul>"},{"location":"setup/clients/fermi/web/","title":"Web Fermi","text":"<p>Fermi is under heavy development but may be used as it's still rather complete</p> <p>Fermi is currently being developed at this repository.</p>"},{"location":"setup/clients/fermi/web/#official-host","title":"Official host","text":"<p>Fermi is officially hosted here</p> <p>Note</p> <p>Fermi supports pointing to your own instance by default, you can read about it here</p> <p>Warning</p> <p>If you want you instance to play nice with other instances of Fermi using their account switchers, you need to disable CORS, or allow requests from the instances of Fermi you trust</p>"},{"location":"setup/clients/fermi/web/#setupbuilding","title":"Setup/Building","text":""},{"location":"setup/clients/fermi/web/#dependencies","title":"Dependencies","text":"<ul> <li>Git</li> <li>NodeJS or Bun</li> </ul> <p>In your terminal:</p> <p><pre><code># Download Fermi\ngit clone https://github.com/MathMan05/Fermi.git\n\n# Enter the cloned directory\ncd Fermi\n\n# Install dependencies\nnpm i\n\n# Or if you're on bun\nbun i\n</code></pre> then build Fermi</p> <pre><code>npm run build\n\n#or if you're on bun\nbun run build\n</code></pre> <p>To start Fermi, run</p> <pre><code>npm run start\n\n# If you're using bun\nbun run start\n</code></pre> <p>Note</p> <p>Fermi defualts to opening on port 8080, if you want to change the port you'll need to change either the env variable PORT or put the port on the command you run, ex: <code>npm start ./dist/index.js 43</code></p> <p>If you're wanting to also develop Fermi, you'll need to start the typescript compiler in watch mode on the base directory of the project.</p>"},{"location":"setup/clients/fermi/web/#contributing","title":"Contributing","text":"<p>To contribute:</p> <ul> <li>Fork Fermi</li> <li>Run the building instructions.</li> <li>Commit &amp; push.</li> <li>Pull request &amp; done!</li> </ul>"},{"location":"setup/clients/fermi/web/#what-can-i-contribute","title":"What can I contribute?","text":"<ul> <li>More settings, and general bug fixes, CSS improvements or anything you think needs to be fixed/improved</li> <li>This is a good list for things that need to be done, though it's incomplete, so if you think something is missing and you want to add it, just do it! MathMan05 is more than willing to answer your questions if you have any!</li> <li>Even if you can't code, there's stuff you can still do! Like reporting bugs, or updating the documentation! Even if you don't help Fermi directly, if you contributed to the Spacebar server itself, it'd still be a huge help towards Fermi, especially if you improve/fix op codes 8/14.</li> <li>If you have a Spacebar instance you can put it on Fermis instance list, if you don't it'll show up on Fermi if it's on the official instance list, but it's good if you do put it on the list as it'll let Fermi have some additional information, and your instance will be higher on the list, even if you partially fill it out, Fermi will merge both listings so no information is lost.</li> <li>Translation work would also be very appreciated. you can do it here if you like</li> </ul>"},{"location":"setup/clients/official/","title":"Spacebar Client","text":"<p>The Spacebar client has 2 versions:</p> <ul> <li>The new, React version which is currently under active development. Docs: React Client</li> <li>The old, legacy React Native version which is no longer under active development. Docs: Legacy Client</li> </ul>"},{"location":"setup/clients/official/legacy/","title":"Legacy Client","text":"<p>This version is no longer under active development! Please see React Client for the current in-development version.</p> <p>Windows support is currently broken.</p>"},{"location":"setup/clients/official/legacy/#official-host","title":"Official host","text":"<p>The client will connect to our official instance by default, or you can use it to connect to your own instance by editing your local storage to include the <code>routeSettings</code> key with the below example content:</p> <pre><code>{\n\"api\": \"https://api.old.server.spacebar.chat/api/v9\",\n\"cdn\": \"https://cdn.old.server.spacebar.chat\",\n\"gateway\": \"wss://gateway.old.server.spacebar.chat\",\n\"invite\": \"https://old.server.spacebar.chat/invite\",\n\"template\": \"https://old.server.spacebar.chat/template\",\n\"gift\": \"https://old.server.spacebar.chat/gift\",\n\"scheduledEvent\": \"https://old.server.spacebar.chat/events\"\n}\n</code></pre> <p>Replace the above endpoints with your own. If your domain name is <code>https://example.com</code>, then you'll most likely want to enter <code>https://example.com/api/v9</code> for the API endpoint, etc.</p> <p>You can also edit these settings by visiting <code>https://client.example.com/settings</code></p>"},{"location":"setup/clients/official/legacy/#setupbuilding","title":"Setup/Building","text":""},{"location":"setup/clients/official/legacy/#dependencies","title":"Dependencies","text":"<ul> <li>Git</li> <li>NodeJS. Version 18+</li> <li>yarn</li> </ul> <p>In your terminal:</p> <pre><code># Download Spacebar Client\ngit clone https://github.com/spacebarchat/client.git -b legacy-v2\n\n# Enter the cloned directory\ncd client\n\n# Install dependencies\nyarn install\n</code></pre> <p>To start the client with Metro for development, run</p> <pre><code>yarn start\n</code></pre> <p>Platform-specific development commands:</p> <p>For development for Android, run</p> <pre><code>yarn android\n</code></pre> <p>For development for iOS, run</p> <pre><code>yarn ios\n</code></pre> <p>For development for Windows, run</p> <pre><code>yarn windows\n</code></pre> <p>To build static files for the web (i.e. when hosting it yourself), run</p> <pre><code>yarn build:web\n</code></pre> <p>Files will be built to <code>web-build</code>. These files need to be served by a Web Server such as Nginx or Apache, the <code>index.html</code> file cannot just be opened in a browser.</p>"},{"location":"setup/clients/official/legacy/#contributing","title":"Contributing","text":"<p>This version is no longer being developed, you are free to clone the repository and make your own changes though!</p>"},{"location":"setup/clients/official/react/","title":"React Client","text":"<p>The Spacebar client is under heavy development and not ready to be used in production yet.</p> <p>The official Spacebar client is currently being developed at this repository.</p>"},{"location":"setup/clients/official/react/#official-host","title":"Official host","text":"<p>The client is currently hosted at https://app.spacebar.chat. You can use it to connect to our official instance by default, or you can use it to connect to your own instance by editing the <code>Instance</code> field on the login page.</p> <p>Note</p> <p>If you've set up wellknown, you can enter that address here. I.e. <code>https://spacebar.chat</code>. If you haven't, you'll need to enter the API endpoint address</p> <p>Warning</p> <p>If you're using the app at https://app.spacebar.chat, you'll need to make sure your instance allows CORS from that address.</p>"},{"location":"setup/clients/official/react/#setupbuilding","title":"Setup/Building","text":""},{"location":"setup/clients/official/react/#dependencies","title":"Dependencies","text":"<ul> <li>Git</li> <li>NodeJS: Version 18+</li> <li>pnpm</li> </ul> <p>In your terminal:</p> <pre><code># Download Spacebar Client\ngit clone https://github.com/spacebarchat/client.git\n\n# Enter the cloned directory\ncd client\n\n# Install dependencies\npnpm install\n</code></pre> <p>To start the client for development, run</p> <pre><code>pnpm dev\n</code></pre> <p>To build static files for the web (i.e. when hosting it yourself), run</p> <pre><code>pnpm build\n</code></pre> <p>Files will be built to <code>build</code>. These files need to be served by a Web Server such as Nginx or Apache, the <code>index.html</code> file cannot just be opened in a browser.</p>"},{"location":"setup/clients/official/react/#contributing","title":"Contributing","text":"<p>To contribute:</p> <ul> <li>Fork the repository</li> <li>Run the building instructions.</li> <li>Commit &amp; Push.</li> <li>Pull Request &amp; Done!</li> </ul>"},{"location":"setup/clients/official/react/#what-can-i-contribute","title":"What can I contribute?","text":"<ul> <li>\"Core\" features like settings, editing messages, dms, markdown rendering, etc. What do you think are basic features that you would want? Some of the GitHub Issues apply to this.</li> <li>Implementing other things like voice/video is fine too, though</li> <li>This is a good starting point and lists the core features that are still missing from the client.</li> </ul>"},{"location":"setup/server/","title":"Server Setup","text":"<p>Spacebar-server setup ranges in difficulty depending on how you want to configure your system. This page provides a minimal setup guide to get you up and running, you should check out the other pages on this site to take your instance to the next level.</p> <p>For this guide, we assume you're familar with the terminal.</p> <p>We do not recommend or support running Spacebar using services such as Ngrok, Heroku or vercel. You must have access to a terminal for this guide.</p> <p>We do not recommend using Windows to run Spacebar.</p>"},{"location":"setup/server/#dependencies","title":"Dependencies","text":"<ul> <li>Git</li> <li>NodeJS. Version 18+ (for <code>npm</code>, <code>node</code> commands)      (NOTE: Ubuntu and Debian based systems often ship with an outdated version of NodeJS, so you can use NodeSource to install a newer version)</li> <li>Python. Version 3.10 or later. Make sure this is executable via <code>python</code> in your terminal.      (See: <code>python-is-python3</code> package)</li> <li>On Linux: <code>gcc</code>/<code>g++</code>. Packaged with <code>build-essential</code> on Debian/Ubuntu and <code>base-devel</code> on Arch.</li> <li>On Windows: Visual Studio (NOT VSCode) with the <code>Desktop development with C++</code> package.     You do not need the full Visual Studio install, the build tools are fine.</li> </ul>"},{"location":"setup/server/#setup","title":"Setup","text":"<p>In your terminal:</p> <pre><code># Download Spacebar\ngit clone https://github.com/spacebarchat/server.git\n\n# Navigate to project root\ncd server\n\n# Install javascript packages\nnpm i\n\n# Build and generate schema. Separately, they are `build` and `generate:schema`.\nnpm run setup\n\n# Start the bundle server ( API, CDN, Gateway in one )\nnpm run start\n</code></pre> <p>If all went according to plan, you can now access your new Spacebar instance at http://localhost:3001! Congrats!</p> <p>If you set up your server remotely, you can use <code>curl http://localhost:3001/api/ping</code> to verify the server is up and running (you should set up a reverse proxy, next!).</p>"},{"location":"setup/server/#connecting-from-remote-machines","title":"Connecting from remote machines","text":"<p>For your server to be a bit more useful to those not on the same machine, you'll need to do a bit more configuration.</p> <p>The official Spacebar client does automatic discovery of the endpoints it uses to communicate with the server, but it needs to retrieve those from somewhere, that being the API server.</p> <p>If you don't tell the API server where to find the other services, the official Spacebar client wont be able to connect. Other clients which don't do automatic discovery will be, but that's because your users will need to provide the locations manually.</p> <p>We'll be doing some server configuration in this step, which is stored in your servers database by default. By default, Spacebar uses an SQLite database in the project root called <code>database.db</code>, but you might not want to use that for production. If you're going to switch databases, do it now.</p> <p>Once you've opened your database, navigate to the <code>config</code> table. You'll see 2 columns named <code>key</code> and <code>value</code>. You'll want to set the <code>value</code> of the rows with the following keys to the correct values.</p> key value <code>api_endpointPublic</code> Your API endpoint. Likely <code>\"https://DOMAIN_NAME/api/v9\"</code> <code>cdn_endpointPublic</code> Your CDN endpoint. Likely <code>\"https://DOMAIN_NAME\"</code> <code>gateway_endpointPublic</code> Your Gateway endpoint. Likely <code>\"wss://DOMAIN_NAME\"</code> <p>You must wrap these <code>value</code>s in doublequotes as they are parsed as JSON!</p> <p>If you're in the CLI for this, heres some template SQL:</p> SQLite <pre><code>update config\nset value = '\"HTTPS_OR_WSS://SERVER_ADDRESS\"'\nwhere key = \"THE_SERVICE_NAME_endpointPublic\";\n</code></pre>"},{"location":"setup/server/#now-what","title":"Now what?","text":"<p>Well, now you can configure Spacebar to your liking!</p> <ul> <li>Skip to server configuration</li> <li>Skip to reverse proxy / SSL</li> <li>Skip to security</li> </ul>"},{"location":"setup/server/database/","title":"Database","text":"<p>By default, Spacebar will use SQLite. SQLite is nice for testing or development. The SQLite database is stored in the <code>database.db</code> file at the server root by default. You may delete this file to regenerate a new SQLite database on the next server start (or through <code>npm run sync:db</code>).</p> <p>However, if you plan to run an instance with any sort of demand, you'd best set up a more Proper\u2122 database such as MariaDB or PostgreSQL, which are both popular choices within the community.</p> <p>We won't go into the setup of these servers here, given the scope of our documentation, but to configure Spacebar to use your shiny new database, simply set the <code>DATABASE</code> environment variable to your new database connection string.</p> <p>Usually, such a string will look something like <code>type://username:password@host-IP:port/databaseName</code></p>"},{"location":"setup/server/email/","title":"Email","text":"<p>Spacebar can be configured to send email, to enable the following functionality:</p> <ul> <li>Email verification</li> <li>Password resets</li> <li>Password change notifications</li> </ul> <p>Spacebar supports the following email transports:</p> <ul> <li>SMTP</li> <li>Mailjet</li> <li>Mailgun</li> <li>Sendgrid</li> </ul> <p>Once you have an account with one of the above services, or an SMTP service, you can begin configuring Spacebar to send mail.</p> <p>You must edit:</p> <ul> <li>The <code>general_frontPage</code> config value, used to generate verification/password reset links.     Be sure to set it to the Spacebar web app URL. For example, <code>https://staging.spacebar.chat</code></li> <li>The <code>email_senderAddress</code> config value, used as the 'from' email address. If it's not set, <code>general_correspondenceEmail</code> is used.</li> </ul> <p>Optionally:</p> <ul> <li>By default users are automatically verified. To change this, update the <code>defaults_user_verified</code> config value to <code>false</code>.</li> <li>If you would like users to be forced to verify their email before using the service, set the <code>login_requireVerification</code> config to <code>true</code>.</li> <li>You may force users to pass a CAPTCHA before requesting a password reset by setting <code>passwordReset_requireCaptcha</code> to <code>true</code></li> </ul>"},{"location":"setup/server/email/#email-config","title":"Email Config","text":"SMTPMailgunMailjetSendgrid key type description email_smtp_host string SMTP Host for sending email email_smtp_port number SMTP port email_smtp_secure boolean Use TLS for SMTP email_smtp_username string SMTP username email_smtp_password string SMTP password key type description email_mailgun_apiKey string Mailgun API key email_mailgun_domain string Mailgun domain key type description email_mailjet_apiKey string Mailjet API key email_mailjet_apiSecret string Mailjet API secret key type description email_sendgrid_apiKey string Sendgrid API key"},{"location":"setup/server/email/#email-templates","title":"Email templates","text":"<p>Spacebar's email templates are stored in <code>spacebar-server/assets/email_templates</code>. They are simple HTML files, which you may edit freely. Although HTML mail is very restricted, so a lot of content may not render properly.</p> <p>Below are the available strings replaced in mail templates.</p> string replaced with <code>{instanceName}</code> <code>general_instanceName</code> config value <code>{userUsername}</code> The username of the user this email is being sent to <code>{userDiscriminator}</code> The discriminator of the user this email is being sent to <code>{userId}</code> The ID of the user this email is being sent to <code>{phoneNumber}</code> The last 4 digits of the user's phone number. <code>{userEmail}</code> The user's email address <code>{actionUrl}</code> The generated password reset or email verification link <code>{ipAddress}</code> The IP address of new login (New login emails are not currently implemented) <code>{locationCity}</code> The GeoIP city of new login <code>{locationRegion}</code> The GeoIP region of new login <code>{locationCountryName}</code> The GeoIP country of new login"},{"location":"setup/server/npmScripts/","title":"NPM scripts","text":"<p>Can be executed using <code>npm run {script name}</code></p>"},{"location":"setup/server/npmScripts/#setup","title":"<code>setup</code>","text":"<p>Shorthand for <code>build</code> and <code>generate:schema</code></p>"},{"location":"setup/server/npmScripts/#syncdb","title":"<code>sync:db</code>","text":"<p>Syncronise the database schema between Spacebar source code and your database. May incur data loss. You do not normally need to run this script, as Spacebar-server will perform it when necessary.</p>"},{"location":"setup/server/npmScripts/#build","title":"<code>build</code>","text":"<p>Builds the Spacebar source code</p>"},{"location":"setup/server/npmScripts/#watch","title":"<code>watch</code>","text":"<p>Starts the compilation of the Spacebar source code in watch mode, automatically recompiling when changes are detected.</p>"},{"location":"setup/server/npmScripts/#start","title":"<code>start</code>","text":"<p>Starts the bundled server. API, Gateway, and CDN run under the same process when using bundle, using the same port.</p>"},{"location":"setup/server/npmScripts/#startapi-startgateway-startcdn","title":"<code>start:api</code>, <code>start:gateway</code>, <code>start:cdn</code>","text":"<p>Starts the respective component.</p>"},{"location":"setup/server/npmScripts/#generaterights","title":"<code>generate:rights</code>","text":"<p>Generates a Discord.com-like rights value for use as a default right. Also displays the 'all rights' value, which <code>1</code> is a placeholder for.</p>"},{"location":"setup/server/npmScripts/#generateschema","title":"<code>generate:schema</code>","text":"<p>Recreates the <code>spacebar-server/assets/schema.json</code> file, which is used for API and Gateway request validation.</p>"},{"location":"setup/server/reverseProxy/","title":"Reverse Proxy","text":""},{"location":"setup/server/reverseProxy/#nginx","title":"NGINX","text":"<p>Generally, our community sets up Spacebar instances behind NGINX, a powerful reverse proxy.</p> <p>Below is an example NGINX config. On Ubuntu, you can put this in the <code>/etc/nginx/sites-available/spacebar.conf</code> file, and enable it with <code>ln -s /etc/nginx/sites-available/spacebar.conf /etc/nginx/sites-enabled/</code> and <code>systemctl restart nginx</code></p> <p>Info</p> <p>Other distros, and Windows, may not have a <code>sites-available</code>, <code>sites-enabled</code> directory structure. You may need to edit the <code>/etc/nginx/nginx.conf</code> file instead, or place new files in a <code>conf.d</code> directory, for example. Check which directories exist on your system to be sure.</p> <p>Note</p> <p>Nginx by default only allows uploads under 1mb in size, if you want to change that you'll need to set the client_max_body_size propery to be some other larger value so that way nginx doesn't reject the request</p> <pre><code>server {\n# Change server_name\nserver_name spacebar.example.com;\nlisten 80;\n\nlocation / {\n# Only change this if Nginx and Spacebar are not on the same machine.\nproxy_pass http://127.0.0.1:3001;\nproxy_set_header Host $host;\nproxy_pass_request_headers      on;\nadd_header Last-Modified $date_gmt;\nadd_header Cache-Control 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';\nproxy_set_header  X-Real-IP $remote_addr;\nproxy_set_header  X-Forwarded-Proto https;\nproxy_set_header  X-Forwarded-For $remote_addr;\nproxy_set_header  X-Forwarded-Host $remote_addr;\nproxy_no_cache 1;\nproxy_cache_bypass 1;\n\n# This is important. It allows Websocket connections through NGINX.\nproxy_set_header Upgrade $http_upgrade;\nproxy_set_header Connection \"upgrade\";\n}\n\n# Uncomment this if using Imagor:\n#location /media/ {\n# # If you changed the port, be sure to change it here too\n# proxy_pass http://127.0.0.1:8000/;\n#}\n}\n</code></pre>"},{"location":"setup/server/reverseProxy/#ssl","title":"SSL","text":"<p>SSL is a technology used to keep your website secure. Put very simply, it's the padlock next to the URL in your browser.</p> <p>After you've set up NGINX, it's very simple to also set up SSL using <code>certbot</code>.</p> UbuntuArchOther Distros <pre><code>sudo apt install certbot python3-certbot-nginx\nsudo certbot --nginx\n</code></pre> <pre><code>sudo pacman -Syu certbot certbot-nginx\nsudo certbot --nginx\n</code></pre> <p>Please refer to Certbots documentation</p> <p>You should be asked various questions, such as which site you want to enable SSL for. After which, you should now have a SSL secured Spacebar instance!</p> <p>But wait, there's more! If you have changed your <code>gateway_endpointPublic</code> or <code>cdn_endpointPublic</code> addresses, you'll probably have to update those to use the new protocol (<code>https</code> or <code>wss</code>).</p>"},{"location":"setup/server/systemd/","title":"SystemD","text":"<p>Below is an example SystemD service for running Spacebar. Save it in <code>/etc/systemd/system/spacebar.service</code>.</p> <pre><code>[Unit]\nDescription=Spacebar, for better and secure communication\n\n[Service]\nUser=&lt;your user&gt;\nWorkingDirectory=&lt;spacebar directory&gt;\nExecStart=npm run start\nRestart=always\nStandardError=journal\nStandardOutput=journal\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Do not run Spacebar as the root user. This is a security risk to your system.</p> <p>Make sure to edit the file as needed, such as replacing the user. It is a good idea to create a new user on your system to run Spacebar. If you would like to run the API, CDN or Gateway separately, you can edit the <code>ExecStart</code> command used in line with the npm script. Also be sure to run RabbitMQ in that case.</p> <p>You can now start Spacebar using <code>sudo systemctl start spacebar</code>.</p> <p>To automatically run Spacebar on boot, use <code>sudo systemctl enable spacebar</code>.</p> <p>To view the server logs, you may use <code>journalctl -u spacebar</code>, or with <code>-f</code> to view them as they come.</p> <p>You may also use the <code>lnav</code> package to get nice, colourised and scrolling output: <code>journalctl -xefu spacebar | lnav</code></p>"},{"location":"setup/server/voice/","title":"Voice","text":"<p>Currently only WebRTC connections are supported. UDP connections will be dropped </p> <p>Voice support is left as an optional dependency in Spacebar, which means that it is disabled by default unless you decide to install additional dependencies. Spacebar is designed so that anyone can develop a voice package compatible with the project as long as the implementation adheres to the WebRTC types. Currently there are two sample implementations which can be used:</p> <ul> <li>Medooze Implementation - Supports video&amp;audio for guild voice, DM voice, as well as GoLive streams. Only supports Linux &amp; MacOS environments.</li> <li>Mediasoup Implementation - Supports audio only for guild voice, DM voice, and GoLive streams. Supports Windows, Linux, and MacOS environments</li> </ul>"},{"location":"setup/server/voice/#configuring-voice-gateway","title":"Configuring Voice Gateway","text":"<p>By default the Voice Gateway is set to run on port 3004. You can change this default configuration by setting your desired port it in your <code>.env</code>:</p> <pre><code>WRTC_WS_PORT=3004\n</code></pre> <p>You also have to configure the Voice Gateway endpoint in your database. In table <code>config</code> you can set the default region endpoint to your Voice Gateway domain. It is set to <code>localhost:3004</code> by default:</p> <pre><code>\"regions_available_0_endpoint\":   \"localhost:3004\"\n</code></pre>"},{"location":"setup/server/voice/#nginx-reverse-proxy-for-voice-gateway","title":"Nginx reverse proxy for Voice Gateway","text":"<p>You will likely want to set your voice gateway behind a reverse proxy. Here's a sample Nginx configuration:</p> <pre><code>server {\n# Change server_name\nserver_name voice.example.com;\nlisten 80;\n\nlocation / {\n# Only change this if Nginx and Spacebar are not on the same machine.\nproxy_pass http://127.0.0.1:3004;\nproxy_set_header Host $host;\nproxy_pass_request_headers      on;\nadd_header Last-Modified $date_gmt;\nadd_header Cache-Control 'no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0';\nproxy_set_header  X-Real-IP $remote_addr;\nproxy_set_header  X-Forwarded-Proto https;\nproxy_set_header  X-Forwarded-For $remote_addr;\nproxy_set_header  X-Forwarded-Host $remote_addr;\nproxy_no_cache 1;\nproxy_cache_bypass 1;\n\n# This is important. It allows Websocket connections through NGINX.\nproxy_set_header Upgrade $http_upgrade;\nproxy_set_header Connection \"upgrade\";\n}\n}\n</code></pre>"},{"location":"setup/server/voice/#configuring-voice-library","title":"Configuring Voice Library","text":"<p>You can install one of the provided sample implementations or you can choose to install another third-party one. Installation process will be the same regardless:</p>"},{"location":"setup/server/voice/#medooze-implementation-installation","title":"Medooze implementation installation","text":"<ol> <li> <p>First install the package in your Spacebar server:</p> <pre><code>npm install @spacebarchat/medooze-webrtc --no-save\n</code></pre> </li> <li> <p>Configure the package name in your Spacebar server <code>.env</code>:</p> <pre><code>WRTC_LIBRARY=@spacebarchat/medooze-webrtc\n</code></pre> </li> <li> <p>Configure the public IP for your WebRTC server in your Spacebar server <code>.env</code>. This should be a public IP that can be accessed from the internet if this is a production instance. It will be the address that will get sent to the client during the WebRTC connection negotiation:</p> <pre><code>WRTC_PUBLIC_IP=127.0.0.1\n</code></pre> </li> </ol>"},{"location":"setup/server/voice/#mediasoup-implementation-installation","title":"Mediasoup implementation installation","text":"<p>The process is exactly the same as the Medooze installation, just replace the package name in the commands with <code>@spacebarchat/mediasoup-webrtc</code></p>"},{"location":"setup/server/wellknown/","title":"well-known","text":"<p>Instance owners may host a <code>/.well-known/spacebar</code> file on a domain containing the instance's API endpoint for Spacebar instance discovery.</p> <p>Users can enter a domain, e.g. <code>spacebar.chat</code> as shorthand, and their client will query <code>https://spacebar.chat/.well-known/spacebar</code> for the instance API URL, and from there the Gateway and CDN endpoints.</p> <p>For example:</p> JSONNGINX <pre><code>{\n\"api\": \"https://api.spacebar.chat/api/v9\"\n}\n</code></pre> <pre><code>location /.well-known/spacebar {\nadd_header Access-Control-Allow-Origin *;\nreturn 200 '{\"api\": \"https://api.spacebar.chat/api/v9\"}';\n}\n</code></pre>"},{"location":"setup/server/configuration/","title":"Configuration","text":"<p>Please see this page for information regarding database configuration or where to access it.</p> <p>The <code>CONFIG_PATH</code> environment variable can be set to make Spacebar use a JSON file instead of a database table.</p> <p>Spacebar's configuration is done through the <code>config</code> table of your database. The table schema consists of two columns <code>key</code> and <code>value</code>, where <code>value</code> is a JSON value. For now, you can update this through SQL manually or a GUI database editor such as DBeaver.</p>"},{"location":"setup/server/configuration/#array-types","title":"Array Types","text":"<p>Arrays are represented by _[number] in a config key. For example, multiple <code>guild_defaultFeatures</code> may be assigned such as</p> key value <code>guild_defaultFeatures_0</code> <code>DISCOVERABLE</code> <code>guild_defaultFeatures_1</code> <code>ANIMATED_ICON</code> etc etc"},{"location":"setup/server/configuration/#available-configuration-options","title":"Available Configuration Options","text":"key default type description gateway_endpointPrivate null string Used for internal communication with gateway gateway_endpointPublic null string Publicly announced gateway endpoint cdn_endpointPrivate null string CDN endpoint. See gateway_endpointPrivate cdn_endpointPublic null string CDN endpoint. See gateway_endpointPublic cdn_resizeHeightMax 1000 number Maximum image resize height for embeds. cdn_resizeWidthMax 1000 number Maximum image resize width for embeds. cdn_imagorServerUrl null string Endpoint to proxy embed images, e.g. using Imagor. api_defaultVersion 9 string API version to use when not specified api_activeVersions_0 6, 7, 8, 9 string[] Allowed API version numbers. Array. api_endpointPublic null string Endpoint the API is available at, usually <code>&lt;Base URL&gt;/api</code> general_instanceName Spacebar Instance string Announced instance name general_instanceDescription This is a Spacebar instance made in the pre-release days string Announced instance description general_frontPage null string Announced instance front page general_tosPage null string Announced instance TOS page general_correspondenceEmail null string Announced instance correspondence email general_correspondenceUserID null Snowflake Announced instance correspondence user ID (from this instance) general_image null string Announced instance image URL general_instanceId Snowflake of instance creation date Snowflake Announced instance ID. Deprecated. general_autoCreateBotUsers false boolean Whether to automatically create a bot when creating an application limits_user_maxGuilds 1048576 number Maxmimum guilds a user can join limits_user_maxUsername 32 number Maximum username length limits_user_maxFriends 5000 number Maximum number of friends per user limits_guild_maxRoles 1000 number Maximum number of roles in a guild limits_guild_maxEmojis 2000 number Maximum number of emojis in a guild limits_guild_maxMembers 25000000 number Maximum number of members in a guild limits_guild_maxChannels 65535 number Maximum number of channels in a guild limits_guild_maxChannelsInCategory 65535 number Maximum number of channels per category in a guild limits_message_maxCharacters 1048576 number Maximum character count per message limits_message_maxTTSCharacters 160 number Maximum character count per text to speech messages limits_message_maxReactions 2048 number Maximum number of reactions per message limits_message_maxAttachmentSize 1073741824 number Maximum total attachment size per message limits_message_maxBulkDelete 1000 number Maximum number of messages deletable through bulk delete limits_message_maxEmbedDownloadSize 5242880 number Maximum download size of external embeddable content limits_channel_maxPins 500 number Maximum number of pins per channel limits_channel_maxTopic 1024 number Maximum channel topic character length limits_channel_maxWebhooks 100 number Maximum number of webhooks per channel limits_rate_enabled false boolean Whether rate limits are enabled limits_rate_ip_count 500 number Allowed number of requests per IP within window limits_rate_ip_window 5 number IP rate limit window, in seconds limits_rate_global_count 250 number Allowed number of requests globally within window limits_rate_global_window 5 number Global rate limit window, in seconds limits_rate_error_count 10 number Number of allowed errors per user within window limits_rate_error_window 5 number User error rate limit window, in seconds limits_rate_routes_guild_count 5 number Allowed number of /guild* requests per user within window limits_rate_routes_guild_window 5 number User /guild* rate limit window, in seconds limits_rate_routes_webhook_count 10 number Allowed number of /webhooks* requests per user within window limits_rate_routes_webhook_window 5 number User /webhooks* rate limit window, in seconds limits_rate_routes_channel_count 10 number Allowed number of /channel* requests per user within window limits_rate_routes_channel_window 5 number User /channel* rate limit window, in seconds limits_rate_routes_auth_login_count 5 number Allowed number of IP /login requests within window limits_rate_routes_auth_login_window 60 number IP /login rate limit window, in seconds limits_rate_routes_auth_register_count 2 number Allowed number of IP /register requests within window limits_rate_routes_auth_register_window 43200 number IP /register rate limit window, in seconds limits_absoluteRate_register_limit 25 number Absolute number of registrations instance-wide per window limits_absoluteRate_register_window 3600000 number Global /register rate limit window, in milliseconds limits_absoluteRate_register_enabled true boolean Whether absolute register rate limits are enabled limits_absoluteRate_sendMessage_limit 200 number Absolute number of messages instance-wide per window limits_absoluteRate_sendMessage_window 60000 number Global sendMessage window, in milliseconds limits_absoluteRate_sendMessage_enabled true boolean Whether absolute message sending rate limits are enabled metrics_timeout 30000 number Currently unused security_captcha_enabled false boolean Whether to enable captchas for login/register security_captcha_service null \"recaptcha\", \"hcaptcha\" Which captcha service to use security_captcha_sitekey null string Captcha service sitekey security_captcha_secret null string Captcha service secret security_twoFactor_generateBackupCodes true boolean Whether to generate backup codes for MFA users security_autoUpdate true boolean Automatically updates NPM packages daily. Currently unused security_requestSignature Random secret string The signature required for CDN or Imagor usage security_jwtSecret Random secret string The secret used for user token generation security_forwardedFor null string HTTP header for user's real IP security_ipdataApiKey Spacebar IPdata key string API key used for IP geolocation and proxy detection security_mfaBackupCodeCount 10 number Number of MFA backup codes to generate security_statsWorldReadable true boolean Whether instance stats are publically accessible or require right security_defaultRegistrationTokenExpiration 604800000 number Registration token expiry in milliseconds login_requireCaptcha false boolean Whether login requires captcha verification login_requireVerification false boolean Whether login requires email verification register_email_required false boolean Whether an email is required for registration register_email_allowlist false boolean Whether <code>register_email_domains</code> is an allowlist register_email_blocklist true boolean Whether <code>register_email_domains</code> is a blocklist register_email_domains [] string[] The email domains list to use as a block/allow list register_dateOfBirth_required true boolean Whether a date of birth is required for registration register_dateOfBirth_minimum 13 number The minimum age of registration register_password_required false boolean Whether a password is required for registration register_password_minLength 8 number Minimum password length register_password_minNumbers 2 number Minimum number of number characters in passwords register_password_minUpperCase 2 number Minimum number of uppercase characters in passwords register_password_minSymbols 0 number Minimum number of symbols in passwords register_disabled false boolean Whether registration is disabled register_requireCaptcha true boolean Whether registration requires captcha verification register_requireInvite false boolean Whether registration requires a guild invite register_guestsRequireInvite true boolean Whether guests accounts require a guild invite register_allowNewRegistration true boolean Whether registration is enabled. Deprecated, use <code>register_disabled</code>. register_allowMultipleAccounts true boolean Allow multiple accounts with the same client fingerprint register_blockProxies true boolean Whether proxies are blocked from registration register_incrementingDiscriminators false boolean Whether discriminators are random or incrementing register_defaultRights 875069521787904 string The rights assigned to users upon registration regions_default spacebar string The default voice region to use regions_useDefaultAsOptimal true boolean Whether to calculate closest or use default as optimal voice region regions_available_0_id spacebar string[] The available voice region IDs regions_available_0_name Spacebar string[] The available voice region names regions_available_0_endpoint 127.0.0.1:3004 string[] The available voice region endpoint URLs regions_available_0_vip false boolean[] Whether this voice region is VIP exclusive regions_available_0_custom false boolean[] Whether this is a custom voice region (used for events/etc) regions_available_0_deprecated false boolean[] Whether this is a deprecated voice region (clients avoid these) guild_discovery_showAllGuilds false boolean Whether guild discovery shows guilds without the DISCOVERABLE feature guild_discovery_useRecommendation false boolean Currently unused guild_discovery_offset 0 number Default offset when returning discoverable guilds. Currently unused guild_discovery_limit 24 number Maximum number of guild discovery elements per page guild_autoJoin_enabled true boolean Whether users auto join guild(s) on registration guild_autoJoin_canLeave true boolean Whether users can leave the auto-joined guild(s) guild_defaultFeatures_0 null string Features automatically granted to guilds upon creation gif_enabled true boolean Whether GIF features are enabled gif_provider tenor \"tenor\" Which GIF service to use gif_apiKey Spacebar tenor API key string GIF service API key rabbitmq_host null string RabbitMQ connection string templates_enabled true boolean Whether guild templates are enabled templates_allowTemplateCreation true boolean Whether new guild templates can be created templates_allowDiscordTemplates true boolean Whether guild templates from Discord.com can be fetched templates_allowRaws true boolean Whether raw guild templates are allowed sentry_enabled false boolean Whether server-side Sentry analytics is enabled sentry_endpoint Spacebar sentry endpoint string Sentry endpoint sentry_traceSampleRate 1 number Sentry sample rate (1 means all requests) sentry_environment System hostname string Sentry environment name defaults_user_premium true boolean Whether users are given premium upon registration defaults_user_premiumType 2 number The premium type given to users upon registration defaults_user_verified true boolean Whether users get verified email upon registration defaults_guild_maxPresences 250000 number Maximum number of presences in a guild upon guild creation defaults_guild_maxVideoChannelUsers 200 number Maximum default number of users in a voice channel with video enabled defaults_guild_afkTimeout 300 number AFK timeout in seconds upon guild creation defaults_guild_defaultMessageNotifications 1 number Message notification level upon guild creation defaults_guild_explicitContentFilter 0 number Explicit content filter level upon guild creation external_twitter null string Twitter API key used for Twitter embeds email_provider null \"smtp\", \"mailgun\", \"mailjet\", \"sendgrid\" Which email transport to use email_senderAddress null string Sender email address. Defaults to <code>general_correspondenceEmail</code> email_smtp_host null string SMTP host for sending email email_smtp_port null number SMTP port email_smtp_secure null boolean Use TLS for SMTP email_smtp_username null string SMTP username email_smtp_password null string SMTP password email_mailgun_apiKey null string Mailgun API key email_mailgun_domain null string Mailgun domain email_mailjet_apiKey null string Mailjet API key email_mailjet_apiSecret null string Mailjet API secret email_sendgrid_apiKey null string Sendgrid API key passwordReset_requireCaptcha false boolean Require captcha to send password reset email"},{"location":"setup/server/configuration/embeds/","title":"Embeds","text":"<p>Embeds in Spacebar are external content that is displayed within your messages when linked to. Spacebar tries its best to fetch content from these external sites, but sometimes we require an API key or other authentication with the site to display their content (or nicer looking embeds).</p> <p>For external images, it's best to set up Imagor or another image proxy for image resizing. The client may or may not fetch images directly from their source if this is not set up, and as such some users may not see all images. In the case where a client does fetch an image from it's source, without Imagor an attacker may be able to learn the IP addresses of users.</p>"},{"location":"setup/server/configuration/embeds/#twitter","title":"Twitter","text":"<p>Go to the Twitter developer portal and sign up for developer access. You must have a phone number attached to your account to sign up. Create an application for use with the Twitter API (We don't need to post messages to Twitter itself). Make sure to create a Bearer token for authentication.</p> <p>Once you have your API key, set the <code>external_twitter</code> config value to your API key, wrapped in quotes.</p>"},{"location":"setup/server/configuration/env/","title":"Environment Variables","text":"<p>Below is a list of environment variables used by Spacebar. You can set environment variables easily by creating an <code>.env</code> file in the <code>spacebar-server</code> folder, with the format <code>NAME=VALUE</code> with each on new lines.</p> Name Value Description THREADS number Number of threads to run Spacebar on when using bundle. Make sure you've enabled RabbitMQ if using more than one PORT number Port to listen on. Used by all components, including bundle. If using bundle, all components run under the same port DATABASE string Database connection string. Defaults to SQLite3 at project root DB_SYNC bool Unsafely synchronise database model on startup. Not recommended for use in production environments! CONFIG_PATH string File path for JSON config, if not using <code>config</code> db table WS_LOGEVENTS boolean If set, log websocket events except messages from gateway WS_VERBOSE boolean If set, log websocket messages sent/received by gateway WS_DUMP boolean If set, dump websocket messages sent/received to disk CDN string Lowest priority value for public CDN announcements GATEWAY string Lowest priority value for public gateway announcements STORAGE_LOCATION string CDN storage location. File path or S3 bucket STORAGE_PROVIDER \"s3\" or \"file\" CDN storage provider STORAGE_BUCKET string S3 bucket name STORAGE_REGION string S3 storage region DB_LOGGING boolean If \"true\", logs all SQL queries to the terminal LOG_REQUESTS filter What requests to log, per response code (eg. <code>-200</code> to log every non-200 response code, or <code>404</code> to log requests with a Not Found status code)"},{"location":"setup/server/configuration/guildFeatures/","title":"Guild Features","text":"<p>Guild features are special modifiers assigned to guilds for additional functionality.</p> <p>In Spacebar, guild features are stored in the <code>features</code> column of the <code>guilds</code> table as a comma separated list, with no spaces. For example, <code>ANIMATED_ICON,BANNER,DISCOVERABLE</code>.</p> <p>A list of all guild features implemented on Discord.com is available here</p> <p>Below is a list of guild features that Spacebar currently implements server-side, including ones not implemented by Discord.com:</p> Feature Description <code>VIP_REGIONS</code> Grants access to VIP voice regions <code>ALIASABLE_NAMES</code> Allows multiple vanity URLs <code>VANITY_URL</code> Allows vanity URLs <code>INTERNAL_EMPLOYEE_ONLY</code> Requires all guild members be staff <code>INVITES_DISABLED</code> Prevents joining this guild <code>CROSS_CHANNEL_REPLIES</code> Allows replies to be from outside the current channel <code>ALLOW_INVALID_CHANNEL_NAMES</code> Allow 'bad' channel names (spaces, invalid characters, etc) <code>IRC_LIKE_CATEGORY_NAMES</code> Use same validation for category names as channel names <code>ALLOW_UNNAMED_CHANNELS</code> Allow unnamed channels/categories <code>DISCOVERABLE</code> Show this guild in Discovery"},{"location":"setup/server/configuration/imageProxy/","title":"Image proxy","text":"<p>If the configuration <code>cdn_imagorServerUrl</code> is empty (which is the default), <code>proxy_url</code> is set to the same value as the original <code>url</code>, causing clients to download images directly from the image host. This may lead to privacy concerns, as an attacker is able to learn users IP addresses.</p> <p>To combat this, Spacebar supports using an image proxy to serve and resize images.</p>"},{"location":"setup/server/configuration/imageProxy/#imagor","title":"Imagor","text":"<p>Imagor is a \"fast, secure image processing server\" used by Spacebar for external image resizing, primarily by embeds from other websites when linked in a message.</p>"},{"location":"setup/server/configuration/imageProxy/#dependencies","title":"Dependencies","text":"<ul> <li>Docker</li> </ul>"},{"location":"setup/server/configuration/imageProxy/#setup","title":"Setup","text":"<p>To setup Imagor for Spacebar, first grab the <code>security_requestSignature</code> config value from Spacebar's database, and create a <code>imagor.env</code> file somewhere safe, with the following content. Make sure to edit the file with the correct information. Your requestSignture should not start or end with <code>\"</code>.</p> <pre><code>IMAGOR_SECRET=security_requestSignature value from your Spacebar config\nPORT=8000\n</code></pre> <p>You can now start Imagor with</p> <pre><code>docker run --env-file ./imagor.env -p 8000:8000 shumc/imagor\n</code></pre> <p><code>8000</code> here is our port. Make sure that it'd available to people outside your network. If you would like to change the port Imagor listens on, be sure to change both the PORT value in <code>imagor.env</code>, and the <code>-p</code> value used in docker.</p> <p>If you're using a reverse proxy such as Nginx for Spacebar already, you could add this to your config's <code>server</code> block</p> <pre><code>location /media/ {\n# If you changed the port, be sure to change it here too\nproxy_pass http://127.0.0.1:8000/;\n}\n</code></pre> <p>Along with any additional config you already have, of course. Alternative (and perhaps the better choice) would be to create a new domain, say <code>media.example.com</code> specifically for Imagor.</p> <pre><code>server {\n# Change the server_name to reflect your true domain\nserver_name media.example.com;\n\nadd_header Last-Modified $date_gmt;\nproxy_set_header Host $host;\nproxy_pass_request_headers on;\nproxy_set_header X-Forwarded-For $remote_addr;\n\nlocation / {\n# If you had changed the port, change it here as well\nproxy_pass http://127.0.0.1:8000;\n}\n}\n</code></pre> <p>Our last step is to simply tell Spacebar about Imagor. Just set the <code>cdn_imagorServerUrl</code> config value to your public endpoint for Imagor, wrapped in quotes.</p> <p>For example, if you used the <code>/media</code> location in your existing nginx config, it will look something like <code>\"https://spacebar.chat/media\"</code>. If you used a subdomain, it will look like <code>\"https://media.spacebar.chat\"</code>. Don't include a trailing backslash.</p> <p>Congrats! After a restart, you've now got Imagor resizing your images!</p>"},{"location":"setup/server/configuration/imageProxy/#built-in-image-proxy","title":"Built-in image proxy","text":"<p>While we recommend using Imagor, Spacebar has a built-in image proxy that can be used instead of Imagor if you just want to test the server or are unable to use Docker.</p> <p>To use it, simply set the <code>cdn_imagorServerUrl</code> to your API URL, but use <code>/imageproxy</code> instead of <code>/api</code>. For example, if the API is running at <code>https://api.spacebar.chat/api</code>, you would set <code>cdn_imagorServerUrl</code> to <code>\"https://api.spacebar.chat/imageproxy\"</code>.</p> <p>Note that to support resizing the image to the given format, it's required to install either sharp (preferred) or jimp:</p> <pre><code>npm install sharp\n</code></pre>"},{"location":"setup/server/configuration/imageProxy/#your-own-image-proxy","title":"Your own image proxy","text":"<p>You can also point the <code>cdn_imagorServerUrl</code> config to your own image proxy, if you have one that supports the Imagor URL format:</p> <ol> <li>Construct URL path: <code>&lt;Image width&gt;x&lt;Height&gt;/&lt;Unencoded URL without https://&gt;</code></li> <li>Create a SHA-1 HMAC of the URL path using <code>security_requestSignature</code></li> <li>Construct final <code>proxy_url</code>: <code>&lt;cdn_imagorServerUrl configuration&gt;/&lt;SHA-1 hash&gt;/&lt;Path from above&gt;</code></li> </ol>"},{"location":"setup/server/configuration/rabbitmq/","title":"RabbitMQ","text":"<p>RabbitMQ is an open source message broker. Spacebar can be configured to use it for communication between the API server and Gateway server. RabbitMQ is required to be set up when you run the API and Gateway servers separately (outside of bundle). Without it, the Gateway server won't know when you send new events for things such as message creation. In the message create case, you will be able to send messages, but will have to reload the client to view new messages from others.</p> <p>After you've downloaded and installed RabbitMQ, edit Spacebar's config, set <code>rabbitmq_host</code> to <code>\"amqp://guest:guest@host:5672\"</code></p> <p>The <code>guest</code> RabbitMQ account can only be accessed via localhost, by default. If you want to run Spacebar over multiple systems, you'll need to set up access control in RabbitMQ.</p>"},{"location":"setup/server/configuration/userFlags/","title":"User Flags","text":"<p>User flags describe special properties of users, including whether they are staff, a verified bot, a bug hunter, etc.</p> <p>You can change a user's flags by setting the <code>public_flags</code> value in the <code>users</code> table. You can assign multiple flags by simply summing the respective values.</p> <p>A list of all user flags implemented on Discord.com is available here</p> <p>Currently, the only user flag to have an effect on server-side functionality is <code>STAFF</code> ( 1 ).</p>"},{"location":"setup/server/maintenance/","title":"Maintenance","text":""},{"location":"setup/server/maintenance/#when-do-i-have-to-restart-the-server","title":"When do I have to restart the server?","text":""},{"location":"setup/server/maintenance/#updating-spacebar-server","title":"Updating Spacebar-server","text":""},{"location":"setup/server/maintenance/restart/","title":"When must the server restart?","text":"<p>Spacebar-server must restart in the following cases:</p> <ul> <li>The .env file or config (database or CONFIG_PATH) has changed.</li> <li>Files in the <code>client_test</code>, <code>preload-plugins</code> folders of inside <code>assets</code> have changed.</li> <li>Files inside <code>src</code> have changed (remember to <code>npm run build</code>).</li> <li>The <code>assets/schemas.json</code> file has changed.</li> <li>The RabbitMQ connection has been lost.</li> </ul> <p>For all other cases, you do not need to restart the server. For example:</p> <ul> <li>Editing any table in the database other than <code>config</code>. For example, to edit a <code>users</code> <code>rights</code></li> <li>Database connection was lost (this should auto reconnect)</li> </ul> <p>This is not an exhaustive list. If a change you made is not applied, the first thing you should try is restarting.</p>"},{"location":"setup/server/maintenance/updating/","title":"Updating","text":"<p>If you followed the setup guide, you'll have installed Spacebar using Git. Thus, you can update the server by running <code>git pull</code> in the <code>spacebar-server</code> directory.</p> <p>If you had made any changes locally, you may run into merge conflicts, where the Spacebar team has made changes to the same code you changed. If it's not important to you, you can simply run <code>git reset --hard HEAD</code> which will delete all your changes. If you want to keep them, you'll have to go through each conflict and resolve them.</p> <p>After downloading the new version, go through the setup guide as normal again:</p> <pre><code># Install any new javascript packages\nnpm i\n\n# Build and generate schema\nnpm run setup\n\n# Start the server\nnpm run start\n</code></pre>"},{"location":"setup/server/security/","title":"Security","text":"<p>There are various security measures available to instance owners.</p>"},{"location":"setup/server/security/#rights","title":"Rights","text":""},{"location":"setup/server/security/#captchas","title":"CAPTCHAs","text":""},{"location":"setup/server/security/#registration-tokens","title":"Registration Tokens","text":""},{"location":"setup/server/security/#rate-limiting","title":"Rate Limiting","text":""},{"location":"setup/server/security/captcha/","title":"CAPTCHAs","text":"<p>Spacebar currently supports two CAPTCHA providers; reCAPTCHA and hCaptcha.</p> hCaptchareCAPTCHA <ol> <li>Navigate to https://www.hcaptcha.com/</li> <li>Create an account - <code>Add hCaptcha for Publishers to my website or app</code></li> <li>Copy your <code>sitekey</code> to the config <code>security_captcha_sitekey</code> value, wrapped in quotes</li> <li>Copy your <code>secret</code> to the config <code>security_captcha_secret</code> value, wrapped in quotes</li> <li>Set the config <code>security_captcha_service</code> value to <code>\"hcaptcha\"</code></li> <li>Set the  <code>security_captcha_enabled</code> value to <code>true</code>, not wrapped in quotes.</li> </ol> <ol> <li>Navigate to https://www.google.com/u/1/recaptcha/admin/create</li> <li>Fill in your websites details</li> <li>Select <code>reCAPTCHA v2</code> -&gt; <code>\"I'm not a robot\" Checkbox</code></li> <li>Add your domain. For example, <code>staging.spacebar.chat</code>. Go to the next screen.</li> <li>Copy your <code>sitekey</code> to the config <code>security_captcha_sitekey</code> value, wrapped in quotes</li> <li>Copy your <code>secret</code> to the config <code>security_captcha_secret</code> value, wrapped in quotes</li> <li>Set the config <code>security_captcha_service</code> value to <code>\"recaptcha\"</code></li> <li>Set the <code>security_captcha_enabled</code> value to <code>true</code>, not wrapped in quotes.</li> </ol> <p>reCAPTCHA v3 and other v2 types may or may not work.</p>"},{"location":"setup/server/security/limits/","title":"Rate Limiting","text":"<p>Spacebar has various forms of rate limiting built in. If you are logged in, you can bypass these with the <code>BYPASS_RATE_LIMITS</code> right</p> <ul> <li>Absolute rate limits, which effect all requests to a route regardless of source (<code>limits_absoluteRate_*</code>)</li> <li>User or IP specific rate limits (<code>limits_rate_*</code>)</li> </ul>"},{"location":"setup/server/security/limits/#absolute-ratelimiting","title":"Absolute ratelimiting","text":"<p>There are currently two types of absolute rate limiting:</p> <ul> <li><code>limits_absoluteRate_register_*</code> - Controls the absolute count of registrations allowed within a window. Useful for mitigating registration spam, in addition to captchas</li> <li><code>limits_absoluteRate_sendMessage_*</code> - Controls the absolute count of messages allowed to be sent within a window.</li> </ul> <p>Absolute rate limits do not consider the source of the request, only the total number of requests instance-wide.</p> <p>Both of the above are individually enabled.</p>"},{"location":"setup/server/security/limits/#userip-specific-ratelimiting","title":"User/IP specific ratelimiting","text":"<p>These rate limits are enabled with a single toggle (<code>limits_rate_enabled</code>)</p> <ul> <li><code>limits_rate_ip_*</code> - Controls the count of requests to any endpoint from a single IP over some window.</li> <li><code>limits_rate_global_*</code> - Number of requests to any endpoint for the same user and IP</li> <li><code>limits_rate_error_*</code> - Number of errors allowed per window for an IP</li> <li><code>limits_rate_routes_guild_*</code> - Guild related requests for same user and IP</li> <li><code>limits_rate_routes_webhook_*</code> - Webhook related requests for same user and IP</li> <li><code>limits_rate_routes_channel_*</code> - Channel related requests for same user and IP</li> <li><code>limits_rate_routes_auth_login_*</code> - Login requests for same user and IP</li> <li><code>limits_rate_routes_auth_register_*</code> - Register requests (successful only) for same IP</li> </ul>"},{"location":"setup/server/security/limits/#what-do-you-mean-by-window-and-count","title":"What do you mean by window and count?","text":"<p>Each ratelimiter accepts a <code>window</code> and <code>count</code>. The rate limiter tracks the number of requests to an endpoint within a <code>window</code>, in seconds. If number of requests within the last <code>window</code> seconds exceeds the <code>count</code> set, it will block the request.</p> <p>For example, setting:</p> <pre><code>limits_rate_ip_count = 10\nlimits_rate_ip_window = 1\n</code></pre> <p>will prevent all requests to any API endpoints from an IP if they exceed 10 requests in 1 second.</p>"},{"location":"setup/server/security/regTokens/","title":"Registration Tokens","text":"<p>Registration tokens are a one-time use token for allowing a new user registration to bypass various restrictions:</p> <ul> <li>Bypass <code>register_disabled = true</code></li> <li>Bypass captchas</li> <li>Bypass <code>register_allowMultipleAccounts = false</code></li> <li>Bypass <code>register_blockProxies = true</code></li> <li>Bypass <code>register_requireInvite = true</code></li> <li>Bypass <code>register_guestsRequireInvite = true</code></li> <li>Bypass absolute register rate limits</li> </ul> <p>To create a registration token, send a GET request to <code>/auth/generate-registration-tokens</code> as an account with <code>OPERATOR</code> rights.</p> <p>There are a few query parameters available. Append them to the request URL, for example <code>/auth/generate-registration-tokens?count=10&amp;plain=true</code></p> Parameter Type Default Description <code>count</code> int 1 The number of tokens to generate <code>plain</code> bool false Return a newline separated string instead of JSON <code>length</code> int 255 The length of each returned token <code>include_url</code> bool false Prefix tokens with URL to register page <p>To use a registration token, append <code>?token={your registration token}</code> to the register route. For example</p> <pre><code>https://staging.spacebar.chat/register?token=some token\n</code></pre>"},{"location":"setup/server/security/rights/","title":"Rights","text":""},{"location":"setup/server/security/rights/#about","title":"About","text":"<p>Rights are instance-wide, per-user permissions for everything you may perform on the instance, such as sending messages, editing messages, or shutting down the server. They are separate from guild member permissions, which only apply to a given guild.</p> <p>You may modify a users rights by editing the <code>rights</code> column in the <code>users</code> table.</p> <p>The rights value is a bitfield string. To grant multiple rights you must add their values together. For example, to grant <code>CREATE_GUILDS</code> and <code>SEND_MESSAGES</code>, set their <code>rights</code> to <code>(1 &lt;&lt; 15) = 32768</code> + <code>(1 &lt;&lt; 25) = 33554432</code> = <code>33587200</code></p> <p>The default rights value given to users (set through the <code>register_defaultRights</code> config value) is generated through the <code>npm run generate:rights</code> script. The script generates a rights value that mimicks Discord.com.</p>"},{"location":"setup/server/security/rights/#operator-rights","title":"OPERATOR Rights","text":"<p>It is EXTREMELY DISCOURAGED to give OPERATOR rights to all users, or to set the default rights to OPERATOR. If your rights value is an odd number, that includes operator.</p> <p>Operator rights currently grants access to the following, in addition to all rights:</p> <ul> <li>Server shutdown through POST <code>/api/stop</code></li> </ul>"},{"location":"setup/server/security/rights/#calculator","title":"Calculator","text":""},{"location":"setup/server/security/rights/#available-rights","title":"Available rights","text":"Right Value When enabled <code>OPERATOR</code> 1 &lt;&lt; 0 All rights <code>MANAGE_APPLICATIONS</code> 1 &lt;&lt; 1 Ability to alter or remove others' applications <code>MANAGE_GUILDS</code> 1 &lt;&lt; 2 Same as the per-guild <code>MANAGE_GUILD</code> permission, but applies to all guilds and DM channels, can join any guild without invite <code>MANAGE_MESSAGES</code> 1 &lt;&lt; 3 Can delete or edit any message they can read <code>MANAGE_RATE_LIMITS</code> 1 &lt;&lt; 4 Add, change, define rate limits of other users, can also grant others <code>BYPASS_RATE_LIMITS</code> when combined with <code>BYPASS_RATE_LIMITS</code> and <code>MANAGE_USERS</code> <code>MANAGE_ROUTING</code> 1 &lt;&lt; 5 Create, alter, enable, disable custom message routing rules in any channel/guild <code>MANAGE_TICKETS</code> 1 &lt;&lt; 6 Respond to or resolve other users' support tickets <code>MANAGE_USERS</code> 1 &lt;&lt; 7 Create, alter, remove, ban users; create, modify, remove user groups <code>ADD_MEMBERS</code> 1 &lt;&lt; 8 Can manually add members into their guilds and group DMs <code>BYPASS_RATE_LIMITS</code> 1 &lt;&lt; 9 Makes the user exempt from all rate limits <code>CREATE_APPLICATIONS</code> 1 &lt;&lt; 10 Can create, edit, remove own applications <code>CREATE_CHANNELS</code> 1 &lt;&lt; 11 Can create guild channels and custom channels <code>CREATE_DMS</code> 1 &lt;&lt; 12 Can create 1:1 DMs (a user without <code>SEND_MESSAGES</code> cannot be added however) <code>CREATE_DM_GROUPS</code> 1 &lt;&lt; 13 Can create group DMs (a user without <code>SEND_MESSAGES</code> cannot be added however) <code>CREATE_GUILDS</code> 1 &lt;&lt; 14 Can create guilds <code>CREATE_INVITES</code> 1 &lt;&lt; 15 Can create mass invites in the guilds that they have <code>CREATE_INSTANT_INVITE</code> <code>CREATE_ROLES</code> 1 &lt;&lt; 16 Can create roles and per-guild or per-channel permission overrides in the guilds that they have permissions <code>CREATE_TEMPLATES</code> 1 &lt;&lt; 17 Can create templates for guilds, custom channels and channels with custom routing <code>CREATE_WEBHOOKS</code> 1 &lt;&lt; 18 Can create webhooks in the guilds that they have permissions <code>JOIN_GUILDS</code> 1 &lt;&lt; 19 Can join guilds by using invites or vanity names <code>PIN_MESSAGES</code> 1 &lt;&lt; 20 Can modify the pinned messages in the guilds that they have permission <code>SELF_ADD_REACTIONS</code> 1 &lt;&lt; 21 Can react to messages, subject to permissions <code>SELF_DELETE_MESSAGES</code> 1 &lt;&lt; 22 Can delete own messages <code>SELF_EDIT_MESSAGES</code> 1 &lt;&lt; 23 Can edit own messages <code>SELF_EDIT_NAME</code> 1 &lt;&lt; 24 Can edit own username, nickname and avatar <code>SEND_MESSAGES</code> 1 &lt;&lt; 25 Can send messages in the channels that they have permissions <code>USE_ACTIVITIES</code> 1 &lt;&lt; 26 Can use voice activities, such as watch together or whiteboard <code>USE_VIDEO</code> 1 &lt;&lt; 27 Can use video and screenshare in guilds/channels that they have permissions <code>USE_VOICE</code> 1 &lt;&lt; 28 Can use voice in guilds/channels that they have permissions <code>INVITE_USERS</code> 1 &lt;&lt; 29 Can create user-specific invites in guilds that they have <code>INVITE_USERS</code> <code>SELF_DELETE_DISABLE</code> 1 &lt;&lt; 30 Can delete/disable own account <code>DEBTABLE</code> 1 &lt;&lt; 31 Can use pay-to-use features once paid <code>CREDITABLE</code> 1 &lt;&lt; 32 Can earn money using monetization features in guilds that have <code>MONETIZATION_ENABLED</code> <code>KICK_BAN_MEMBERS</code> 1 &lt;&lt; 33 Can kick or ban guild or group DM members in the guilds/groups that they have KICK_MEMBERS, or BAN_MEMBERS <code>SELF_LEAVE_GROUPS</code> 1 &lt;&lt; 34 Can leave the guilds or group DMs that they joined on their own (one can always leave a guild or group DMs they have been force-added) <code>PRESENCE</code> 1 &lt;&lt; 35 Inverts the presence confidentiality default (OPERATOR's presence is not routed by default, others' are) for a given user <code>SELF_ADD_DISCOVERABLE</code> 1 &lt;&lt; 36 Can mark discoverable guilds that they have permissions to mark as discoverable <code>MANAGE_GUILD_DIRECTORY</code> 1 &lt;&lt; 37 Can change anything in the primary guild directory <code>POGGERS</code> 1 &lt;&lt; 38 Can send confetti, screenshake, random user mention (@someone) <code>USE_ACHIEVEMENTS</code> 1 &lt;&lt; 39 Can use achievements and cheers <code>INITIATE_INTERACTIONS</code> 1 &lt;&lt; 40 Can initiate interactions <code>RESPOND_TO_INTERACTIONS</code> 1 &lt;&lt; 41 Can respond to interactions <code>SEND_BACKDATED_EVENTS</code> 1 &lt;&lt; 42 Can send backdated events <code>USE_MASS_INVITES</code> 1 &lt;&lt; 43 Can accept mass (guild) invites <code>ACCEPT_INVITES</code> 1 &lt;&lt; 44 Can accept user-specific invites and DM requests <code>SELF_EDIT_FLAGS</code> 1 &lt;&lt; 45 Can modify own flags <code>EDIT_FLAGS</code> 1 &lt;&lt; 46 Can modify other's flags <code>MANAGE_GROUPS</code> 1 &lt;&lt; 47 Can manage other's groups <code>VIEW_SERVER_STATS</code> 1 &lt;&lt; 48 Can view server stats /api/policies/stats <code>RESEND_VERIFICATION_EMAIL</code> 1 &lt;&lt; 49 Can resend verification emails (<code>/auth/verify/resend</code>) <code>CREATE_REGISTRATION_TOKENS</code> 1 &lt;&lt; 50 Can create registration tokens (<code>/auth/generate-registration-tokens</code>)"}]}